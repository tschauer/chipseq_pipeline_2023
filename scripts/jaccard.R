


##################################################################################################################################
##################################################################################################################################


library(ShortRead)
library(rtracklayer)
library(pheatmap)
library(RColorBrewer)

args = commandArgs(trailingOnly=TRUE)


##################################################################################################################################
##################################################################################################################################


my_bed_files <- grep(".bed", args, value = TRUE)

my_sample_names <- gsub(".*\\/|_filt.*", "", my_bed_files)

output <- grep(".pdf", args, value = TRUE)


##################################################################################################################################
##################################################################################################################################


jaccard <- function(gr1, gr2){
        
        jac <- sum(width(intersect(gr1, gr2))) / sum(width(union(gr1, gr2)))
        
        jac
}


##################################################################################################################################
##################################################################################################################################


m <- matrix(nrow = length(my_bed_files), ncol = length(my_bed_files), 
            dimnames = list(my_sample_names, my_sample_names))


for(i in seq_along(my_bed_files)){
        
        for(j in seq_along(my_sample_names)){
                
                gr1 <- import.bed(my_bed_files[i])
                gr2 <- import.bed(my_bed_files[j])
                
                m[i,j] <- jaccard(gr1, gr2)
        }
}


##################################################################################################################################
##################################################################################################################################


pdf(file = output, width = 6, height = 6)

pheatmap(m, 
         display_numbers = TRUE,
         main = "Jaccard Similarity of Peaks",
         cellwidth = 50, cellheight = 50,
         color = colorRampPalette(rev(brewer.pal(9, name = "RdBu")))(101),
         breaks = seq(0,0.6, length.out = 101))

dev.off()


##################################################################################################################################
##################################################################################################################################










##################################################################################################################################
##################################################################################################################################
